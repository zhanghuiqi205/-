##  前端性能优化：
我之前看过雅虎军规说过的一些前端优化策略。还有网上很多别人写过的一些优化策略.现在就结合我工作的实例，给大家讲解一下。其实雅虎军规的36条很实用，比如减少http请求次数,压缩并优化css，js，image。充分利用缓存,利用懒加载等方式延迟数据显示。                                                                                                              
- 减少http请求次数： 现在有很多现成的库可以帮你将多个脚本文件捆绑成一个文件，将多个样式表文件捆绑成一个文件，以此来减少文件的下载次数。把多个图片拼成一副图片，然后通过CSS来控制在什么地方具体显示这整张图片的什么位置。                                                                                                    
- 减少DNS查询次数：DNS查询也消耗响应时间，如果我们的网页内容来自各个不同的域名。DNS查询一般是对首次访问响应速度有所影响.                             
基本的策略如下：                                                                                                                        
![image](https://github.com/zhanghuiqi205/Source-code-analysis/blob/master/image/%E4%BC%98%E5%8C%96.png)
- 今天我们从实际出发，给大家讲讲前端优化的建议：
1. 我们从网页中最耗费流量的图片说起,对于固定的图片内容是采取尽可能的读取缓存。比如网站标志logo，网站底部的资质认证，大型合作伙伴。这种让人必须记住且重要的信息，基本都是一百年不会变的，都采取了尽可能的读取缓存的设置。第一次可能打开网页比较慢，但是后续会大大提高速度的.这也是我们很多网站建议，对于固定不变的内容，尽可能的使用缓存的资源。                                                                                                       
1. 对于很多零散的图片采用了合并的方式，一来减少请求次数，二来方便压缩和减少图片的体积。比如制作网站介绍和零散图标。就是很多网上说的雪碧图或者图片精灵合成的图片文件。通过对图片位置的控制来到达目标.                                                                                            
1. 建议是：对于小的图标尽可能使用 iconfont图标.iconfont图标，比图片更好一些，可以通过css的一些字体属性来进行调整。如果网站的小图标能用字体来代替的，尽可能的使用这种字体。比如[阿里字体库](http://www.iconfont.cn/)就是个不错的资源。                                                             
1. 减少图片额外请求数，收益比较明显的一般有三个方法：图片合并、iconfont 图标、Base64这三种方法有不同的优缺点：
   1. 图片合并：                                  
优点：兼容性强可缓存可提前加载多态图可提升图片加载显示体验                                                    
缺点：维护性差、合并图片类型以及大小控制限制高、有可能造成资源浪费                  
适合：修改更新少的常驻型低色位的装饰小图                                                                                    
   1. Iconfont：                                                                                                
优点：可缓存矢量性可控性强                                                              
缺点：存在浏览器渲染差异性、只能纯色、文件体积略大                                                            
适合：纯色图标                                                            
   1. Base64：                                                                                                    
优点：无额外请求                                                                                              
缺点：不可缓存、兼容性差、代码冗余、可读性差、维护不便、CPU内存耗损大                                                                         
适合：体积小复用率低的背景装饰图标。                                                                                                     
1. 接着我们来分析css文件对于我们前端优化的做法：
   1. css的位置：在文档的位置处于顶部，这也是为了可以快速渲染出来网站，在dom渲染完成后，迅速完成样式的渲染，避免单调的网站布局                           
   1. 压缩css：comm，采取压缩。基本所有的都是这样的形式gzip编码，且采用了cdn缓存服务器。
   2. css文件的渲染其实就是浏览器渲染过程的一个重要的过程.在渲染的过程中尽可能的避免Reflow（回流/重排），和Repaint(重绘)。大家可能很想知道重排和重绘是怎么回事。那我们就要说说浏览器的渲染页面的过程了。浏览器下载完页面中的所有组件——HTML标记、JavaScript、CSS、图片之后会解析生成两个内部数据结构——DOM树和渲染树。
      1. DOM树表示页面结构，渲染树表示DOM节点如何显示。DOM树中的每一个需要显示的节点在渲染树种至少存在一个对应的节点（隐藏的DOM元素 disply值为none在渲染树中没有对应的节点）。渲染树中的节点被称为“帧”或“盒”,符合CSS模型的定义，理解页面元素为一个具有填充，边距，边框和位置的盒子。一旦DOM和渲染树构建完成，浏览器就开始显示（绘制）页面元素。
      2. 当DOM的变化影响了元素的几何属性（宽或高），浏览器需要重新计算元素的几何属性，同样其他元素的几何属性和位置也会因此受到影响。浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。这个过程称为重排。完成重排后，浏览器会重新绘制受影响的部分到屏幕，该过程称为重绘。
      3. 很显然，每次重排，必然会导致重绘，那么，重排会在哪些情况下发生？
         - 添加或者删除可见的DOM元素
         - 元素位置改变
         - 元素尺寸改变
         - 元素内容改变（例如：一个文本被另一个不同尺寸的图片替代）
         - 页面渲染初始化（无法避免）
         - 浏览器窗口尺寸改变

    ![image](https://github.com/zhanghuiqi205/Source-code-analysis/blob/master/image/domandcss.png)   
    实际上对于CSS的优化还有很多，比如尽可能不要深套选择器，使用继承的属性让代码量尽可能的减少等等。大家可以从网上找到很多对应的方法，不过我觉得要尽可能的在项目中使用，让好的东西在实际中使用起来。
1. 接下来我们主要说一下JavaScript的文件，我们是如何做优化的：这部分是我们最关心的，怎么能让我们的代码运行的更流程，相互之间的耦合性降低，达到最优的水平。
   1. JavaScript的位置：因为js的单线程的运行，所以我们要把很重的解析js的任务放在DOM和CSS之后，这样我们才能让我们的网页更快的呈现在客户的面前。



